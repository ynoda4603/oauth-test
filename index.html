document.getElementById('loginBtn').addEventListener('click', async () => { // async/await を使用するために async を追加
  // Client Credentials Grant では state や redirect_uri は通常不要です。
  // const state = generateRandomString();
  // localStorage.setItem('oauth_state', state);
  // ★セキュリティに関する非常に重要な注意★
  // クライアントサイドのJavaScriptで client_secret を扱うことは、
  // ブラウザの開発者ツールなどで誰でも閲覧可能になるため、非常に危険です。
  // Client Credentials Grant は通常、サーバーサイドアプリケーションなど、
  // クライアントシークレットを安全に保管できる環境で使用されます。
  // もしSalesforceのようなプラットフォームでフロントエンドから利用する場合は、
  // この方法が適切か、セキュリティリスクを十分に検討してください。
  // 代わりにBackend for Frontend (BFF) パターンを検討するか、
  // Salesforceが推奨する他のOAuthフロー（PKCEを伴う認可コードフローなど、
  // ただしClient Credentialsとは目的が異なります）の利用を検討してください。
  const tokenUrl = 'https://ynoda4603.github.io/oauth-test/callback.html'; // ★ここを実際のトークンエンドポイントURLに置き換えてください★
  const clientId = '3MVG929eOx29turHjzNb74yZQnXr5uJtUsDrzM__YQJ3v.Ta9KLfsqAtjHafYKqzMaK5pAIRywXy7dvix2KuZ';       // ★ここを実際のクライアントIDに置き換えてください★
  const clientSecret = '3D066D0E344B0E3286C048CAAEBA0EC23F64651D3CE8D5209DFEBE8478F3C0C4'; // ★ここを実際のクライアントシークレットに置き換えてください (セキュリティリスク!)★
  // リクエストボディの準備 (application/x-www-form-urlencoded 形式)
  const params = new URLSearchParams();
  params.append('grant_type', 'client_credentials');
  params.append('client_id', clientId);
  params.append('client_secret', clientSecret);
  // params.append('scope', 'api'); // 必要に応じてスコープを指定
  try {
    const response = await fetch(tokenUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: params.toString(), // URLSearchParamsオブジェクトを文字列化してボディに設定
    });
    if (response.ok) {
      const tokenData = await response.json(); // レスポンスは通常JSON形式
      console.log('トークン取得成功:', tokenData);
      // ここで取得したアクセストークン (例: tokenData.access_token) を使用する処理
      // 例: localStorage.setItem('access_token', tokenData.access_token);
      //     alert('アクセストークンを取得しました: ' + tokenData.access_token);
    } else {
      // エラーレスポンスもJSON形式の場合があるので、内容を確認
      let errorData = null;
      try {
        errorData = await response.json();
      } catch (e) {
        errorData = await response.text(); // JSONでなければテキストとして取得
      }
      console.error('トークン取得失敗:', response.status, response.statusText, errorData);
      alert(`トークンの取得に失敗しました。ステータス: ${response.status} \n詳細はコンソールを確認してください。`);
    }
  } catch (error) {
    console.error('通信エラー:', error);
    alert('トークン取得時に通信エラーが発生しました。\n詳細はコンソールを確認してください。');
  }
});
// generateRandomString 関数は Client Credentials Grant では通常不要です。
// function generateRandomString() { /* ... */ }
