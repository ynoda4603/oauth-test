<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Salesforce OAuth Callback</title>
</head>
<body>
  <h1>アクセストークン取得</h1>
  <pre id="output">トークン取得中...</pre>

  <script>
    function parseHashParams(hash) {
      const params = {};
      const queryString = hash.substring(1);
      const regex = /([^&=]+)=([^&]*)/g;
      let m;
      while ((m = regex.exec(queryString))) {
        params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
      }
      return params;
    }

    (async () => {
      const output = document.getElementById('output');
      const hashParams = parseHashParams(window.location.hash);
      const accessToken = hashParams.access_token;
      const instanceUrl = hashParams.instance_url;

      if (!accessToken || !instanceUrl) {
        output.textContent = 'アクセストークンまたはインスタンスURLが取得できませんでした。';
        return;
      }

      output.textContent = `アクセストークン取得成功！\n\naccess_token: ${accessToken}\ninstance_url: ${instanceUrl}`;

      // ここでAPI呼び出し可能
      // 例:
      // const response = await fetch(`${instanceUrl}/services/data/v59.0/sobjects/Account`, {
      //   method: 'GET',
      //   headers: {
      //     'Authorization': `Bearer ${accessToken}`
      //   }
      // });
      // const data = await response.json();
      // console.log(data);
    })();
  </script>
</body>
</html>
